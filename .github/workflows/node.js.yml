name: Cypress Tests & github actions
'on':
  push:
    branches:
      - master

jobs:
  cypress-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      
      # Install NPM dependencies, cache them correctly
      # and run all Cypress tests
      - name: Cypress run
        uses: cypress-io/github-action@v2
        with:
          build: yarn build
          start: yarn serve
        
      # report machine parameters
      - run: yarn cypress info
      - run: node -p 'os.cpus()'

      # upload reports to firebase
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.AUTH_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_DRIP_PROJECTS }}'
          channelId: live
          projectId: drip-projects
        env:
          VUE_APP_TEST: ${{ secrets.MY_ENV }}
          
